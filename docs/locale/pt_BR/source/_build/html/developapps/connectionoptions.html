

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>&lt;no title&gt; &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="wallet.html" />
    <link rel="prev" title="&lt;no title&gt;" href="connectionprofile.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in Hyperledger Fabric v2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Principais Conceitos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_guide_overview.html">Deploying a production network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">Upgrading to the latest release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="developing_applications.html">Developing Applications</a> &raquo;</li>
        
          <li><a href="designelements.html">Application design elements</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developapps/connectionoptions.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># Connection Options</p>
<p><strong>Audience</strong>: Architects, administrators, application and smart contract
developers</p>
<p>Connection options are used in conjunction with a connection profile to control
<em>precisely</em> how a gateway interacts with a network. Using a gateway allows an
application to focus on business logic rather than network topology.</p>
<p>In this topic, we’re going to cover:</p>
<ul class="simple">
<li><p>[Why connection options are important](#scenario)</p></li>
<li><p>[How an application uses connection options](#usage)</p></li>
<li><p>[What each connection option does](#options)</p></li>
<li><p>[When to use a particular connection option](#considerations)</p></li>
</ul>
<p>## Scenario</p>
<p>A connection option specifies a particular aspect of a gateway’s behaviour.
Gateways are important for [many reasons](./gateway.html), the primary being to
allow an application to focus on business logic and smart contracts, while it
manages interactions with the many components of a network.</p>
<p>![profile.scenario](./develop.diagram.35.png) <em>The different interaction points
where connection options control behaviour. These options are explained fully in
the text.</em></p>
<p>One example of a connection option might be to specify that the gateway used by
the <cite>issue</cite> application should use identity <cite>Isabella</cite> to submit transactions to
the <cite>papernet</cite> network. Another might be that a gateway should wait for all
three nodes from MagnetoCorp to confirm a transaction has been committed
returning control. Connection options allow applications to specify the precise
behaviour of a gateway’s interaction with the network. Without a gateway,
applications need to do a lot more work; gateways save you time, make your
application more readable, and less error prone.</p>
<p>## Usage</p>
<p>We’ll describe the [full set](#options) of connection options available to an
application in a moment; let’s first see how they are specified by the
sample MagnetoCorp <cite>issue</cite> application:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>javascript
const userName = <a class="reference external" href="mailto:'User1&#37;&#52;&#48;org1&#46;example&#46;com">‘User1<span>&#64;</span>org1<span>&#46;</span>example<span>&#46;</span>com</a>’;
const wallet = new FileSystemWallet(‘../identity/user/isabella/wallet’);</p>
<dl>
<dt>const connectionOptions = {</dt><dd><p>identity: userName,
wallet: wallet,
eventHandlerOptions: {</p>
<blockquote>
<div><p>commitTimeout: 100,
strategy: EventStrategies.MSPID_SCOPE_ANYFORTX
}</p>
</div></blockquote>
<p>};</p>
</dd>
</dl>
<p>await gateway.connect(connectionProfile, connectionOptions);
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>See how the <cite>identity</cite> and <cite>wallet</cite> options are simple properties of the
<cite>connectionOptions</cite> object. They have values <cite>userName</cite> and <cite>wallet</cite>
respectively, which were set earlier in the code. Contrast these options with
the <cite>eventHandlerOptions</cite> option which is an object in its own right. It has
two properties: <cite>commitTimeout: 100</cite> (measured in seconds) and <cite>strategy:
EventStrategies.MSPID_SCOPE_ANYFORTX</cite>.</p>
<p>See how <cite>connectionOptions</cite> is passed to a gateway as a complement to
<cite>connectionProfile</cite>; the network is identified by the connection profile and
the options specify precisely how the gateway should interact with it. Let’s now
look at the available options.</p>
<p>## Options</p>
<p>Here’s a list of the available options and what they do.</p>
<ul>
<li><p><cite>wallet</cite> identifies the wallet that will be used by the gateway on behalf of
the application. See interaction <strong>1</strong>; the wallet is specified by the
application, but it’s actually the gateway that retrieves identities from it.</p>
<p>A wallet must be specified; the most important decision is the
[type](./wallet.html#type) of wallet to use, whether that’s file system,
in-memory, HSM or database.</p>
</li>
<li><p><cite>identity</cite> is the user identity that the application will use from <cite>wallet</cite>.
See interaction <strong>2a</strong>; the user identity is specified by the application and
represents the user of the application, Isabella, <strong>2b</strong>. The identity is
actually retrieved by the gateway.</p>
<p>In our example, Isabella’s identity will be used by different MSPs (<strong>2c</strong>,
<strong>2d</strong>) to identify her as being from MagnetoCorp, and having a particular
role within it. These two facts will correspondingly determine her permission
over resources, such as being able to read and write the ledger, for example.</p>
<p>A user identity must be specified. As you can see, this identity is
fundamental to the idea that Hyperledger Fabric is a <em>permissioned</em> network –
all actors have an identity, including applications, peers and orderers, which
determines their control over resources. You can read more about this idea in the membership services [topic](../membership/membership.html).</p>
</li>
<li><p><cite>clientTlsIdentity</cite> is the identity that is retrieved from a wallet (<strong>3a</strong>)
and used for secure communications (<strong>3b</strong>) between the gateway and different
channel components, such as peers and orderers.</p>
<p>Note that this identity is different to the user identity.  Even though
<cite>clientTlsIdentity</cite> is important for secure communications, it is not as
foundational as the user identity because its scope does not extend beyond
secure network communications.</p>
<p><cite>clientTlsIdentity</cite> is optional. You are advised to set it in production
environments. You should always use a different <cite>clientTlsIdentity</cite> to
<cite>identity</cite> because these identities have very different meanings and
lifecycles. For example, if your <cite>clientTlsIdentity</cite> was compromised, then so
would your <cite>identity</cite>; it’s more secure to keep them separate.</p>
</li>
<li><dl class="simple">
<dt><cite>eventHandlerOptions.commitTimeout</cite> is optional. It specifies, in seconds, the</dt><dd><p>maximum amount of time the gateway should wait for a transaction to be
committed by any peer (<strong>4a</strong>) before returning control to the application.
The set of peers to use for notification is determined by the
<cite>eventHandlerOptions.strategy</cite> option. If a commitTimeout is not
specified, the gateway will use a timeout of 300 seconds.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>eventHandlerOptions.strategy</cite> is optional. It identifies the set of peers</dt><dd><p>that a gateway should use to listen for notification that a transaction has
been committed. For example, whether to listen for a single peer, or all
peers, from its organization. It can take one of the following values:</p>
</dd>
</dl>
<ul>
<li><p><cite>EventStrategies.MSPID_SCOPE_ANYFORTX</cite> Listen for <strong>any</strong> peer within the
user’s organization. In our example, see interaction points <strong>4b</strong>; any of
peer 1, peer 2 or peer 3 from MagnetoCorp can notify the gateway.</p></li>
<li><dl class="simple">
<dt><cite>EventStrategies.MSPID_SCOPE_ALLFORTX</cite> <strong>This is the default value</strong>. Listen</dt><dd><p>for <strong>all</strong> peers within the user’s organization. In our example peer, see
interaction point <strong>4b</strong>. All peers from MagnetoCorp must all have notified
the gateway; peer 1, peer 2 and peer 3. Peers are only counted if they are
known/discovered and available; peers that are stopped or have failed are
not included.</p>
</dd>
</dl>
</li>
<li><p><cite>EventStrategies.NETWORK_SCOPE_ANYFORTX</cite> Listen for <strong>any</strong> peer within the
entire network channel. In our example, see interaction points <strong>4b</strong> and
<strong>4c</strong>; any of peer 1-3 from MagnetoCorp or peer 7-9 of DigiBank can notify
the gateway.</p></li>
<li><p><cite>EventStrategies.NETWORK_SCOPE_ALLFORTX</cite> Listen for <strong>all</strong> peers within the
entire network channel. In our example, see interaction points <strong>4b</strong> and
<strong>4c</strong>. All peers from MagnetoCorp and DigiBank must notify the gateway;
peers 1-3 and peers 7-9. Peers are only counted if they are known/discovered
and available; peers that are stopped or have failed are not included.</p></li>
<li><p>&lt;<cite>PluginEventHandlerFunction</cite>&gt; The name of a user-defined event handler.
This allows a user to define their own logic for event handling. See how to
[define](<a class="reference external" href="https://hyperledger.github.io/fabric-sdk-node/master/tutorial-transaction-commit-events.html">https://hyperledger.github.io/fabric-sdk-node/master/tutorial-transaction-commit-events.html</a>)
a plugin event handler, and examine a [sample
handler](<a class="reference external" href="https://github.com/hyperledger/fabric-sdk-node/blob/master/test/integration/network-e2e/sample-transaction-event-handler.js">https://github.com/hyperledger/fabric-sdk-node/blob/master/test/integration/network-e2e/sample-transaction-event-handler.js</a>).</p>
<p>A user-defined event handler is only necessary if you have very specific
event handling requirements; in general, one of the built-in event
strategies will be sufficient. An example of a user-defined event handler
might be to wait for more than half the peers in an organization to confirm
a transaction has been committed.</p>
<p>If you do specify a user-defined event handler, it does not affect your
application logic; it is quite separate from it. The handler is called by
the SDK during processing; it decides when to call it, and uses its results
to select which peers to use for event notification. The application
receives control when the SDK has finished its processing.</p>
<p>If a user-defined event handler is not specified then the default values for
<cite>EventStrategies</cite> are used.</p>
</li>
</ul>
</li>
<li><p><cite>discovery.enabled</cite> is optional and has possible values <cite>true</cite> or <cite>false</cite>. The
default is <cite>true</cite>. It determines whether the gateway uses [service
discovery](../discovery-overview.html) to augment the network topology
specified in the connection profile. See interaction point <strong>6</strong>; peer’s
gossip information used by the gateway.</p>
<p>This value will be overridden by the <cite>INITIALIIZE-WITH-DISCOVERY</cite> environment
variable, which can be set to <cite>true</cite> or <cite>false</cite>.</p>
</li>
<li><p><cite>discovery.asLocalhost</cite> is optional and has possible values <cite>true</cite> or <cite>false</cite>.
The default is <cite>true</cite>. It determines whether IP addresses found during service
discovery are translated from the docker network to the local host.</p>
<p>Typically developers will write applications that use docker containers for
their network components such as peers, orderers and CAs, but that do not run
in docker containers themselves. This is why <cite>true</cite> is the default; in
production environments, applications will likely run in docker containers in
the same manner as network components and therefore address translation is not
required. In this case, applications should either explicitly specify <cite>false</cite>
or use the environment variable override.</p>
<p>This value will be overridden by the <cite>DISCOVERY-AS-LOCALHOST</cite> environment
variable, which can be set to <cite>true</cite> or <cite>false</cite>.</p>
</li>
</ul>
<p>## Considerations</p>
<p>The following list of considerations is helpful when deciding how to choose
connection options.</p>
<ul>
<li><p><cite>eventHandlerOptions.commitTimeout</cite> and <cite>eventHandlerOptions.strategy</cite> work
together. For example, <cite>commitTimeout: 100</cite> and <cite>strategy:
EventStrategies.MSPID_SCOPE_ANYFORTX</cite> means that the gateway will wait for up
to 100 seconds for <em>any</em> peer to confirm a transaction has been committed. In
contrast, specifying <cite>strategy:  EventStrategies.NETWORK_SCOPE_ALLFORTX</cite> means
that the gateway will wait up to 100 seconds for <em>all</em> peers in <em>all</em>
organizations.</p></li>
<li><p>The default value of <cite>eventHandlerOptions.strategy:
EventStrategies.MSPID_SCOPE_ALLFORTX</cite> will wait for all peers in the
application’s organization to commit the transaction. This is a good default
because applications can be sure that all their peers have an up-to-date copy
of the ledger, minimizing concurrency
issues &lt;!– Add a link with more information explaining this topic–&gt;</p>
<p>However, as the number of peers in an organization grows, it becomes a little
unnecessary to wait for all peers, in which case using a pluggable event
handler can provide a more efficient strategy. For example the same set of
peers could be used to submit transactions and listen for notifications, on
the safe assumption that consensus will keep all ledgers synchronized.</p>
</li>
<li><p>Service discovery requires <cite>clientTlsIdentity</cite> to be set. That’s because the
peers exchanging information with an application need to be confident that
they are exchanging information with entities they trust. If
<cite>clientTlsIdentity</cite> is not set, then <cite>discovery</cite> will not be obeyed,
regardless of whether or not it is set.</p></li>
<li><p>Although applications can set connection options when they connect to the
gateway, it can be necessary for these options to be overridden by an
administrator. That’s because options relate to network interactions, which
can vary over time. For example, an administrator trying to understand the
effect of using service discovery on network performance.</p>
<p>A good approach is to define application overrides in a configuration file
which is read by the application when it configures its connection to the
gateway.</p>
<p>Because the discovery options <cite>enabled</cite> and <cite>asLocalHost</cite> are most frequently
required to be overridden by administrators, the environment variables
<cite>INITIALIIZE-WITH-DISCOVERY</cite> and <cite>DISCOVERY-AS-LOCALHOST</cite> are provided for
convenience. The administrator should set these in the production runtime
environment of the application, which will most likely be a docker container.</p>
</li>
</ul>
<p>&lt;!— Licensed under Creative Commons Attribution 4.0 International License
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a> –&gt;</p>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wallet.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="connectionprofile.html" class="btn btn-neutral" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>