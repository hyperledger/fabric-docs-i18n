

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>} &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using Private Data in Fabric" href="../private_data_tutorial.html" />
    <link rel="prev" title="Writing Your First Application" href="../write_first_app.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in Hyperledger Fabric v2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Principais Conceitos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../test_network.html">##### Generate certificates using cryptogen tool #########</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_network.html#create-org1-identities">############ Create Org1 Identities ######################</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy_chaincode.html">}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy_chaincode.html#id12">}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy_chaincode.html#id21">}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy_chaincode.html#id24">}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy_chaincode.html#id43">}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../private_data_tutorial.html">Using Private Data in Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../couchdb_tutorial.html">Using CouchDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../channel_update_tutorial.html">Adding an Org to a Channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build_network.html">Building Your First Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_guide_overview.html">Deploying a production network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">Upgrading to the latest release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>}</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/commercial_paper.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># Commercial paper tutorial</p>
<p><strong>Audience:</strong> Architects, application and smart contract developers,
administrators</p>
<p>This tutorial will show you how to install and use a commercial paper sample
application and smart contract. It is a task-oriented topic, so it emphasizes
procedures above concepts. When you’d like to understand the concepts in more
detail, you can read the
[Developing Applications](../developapps/developing_applications.html) topic.</p>
<p>![commercialpaper.tutorial](./commercial_paper.diagram.1.png) <em>In this tutorial
two organizations, MagnetoCorp and DigiBank, trade commercial paper with each
other using PaperNet, a Hyperledger Fabric blockchain network.</em></p>
<p>Once you’ve set up the test network, you’ll act as Isabella, an employee of
MagnetoCorp, who will issue a commercial paper on its behalf. You’ll then switch
roles to take the role of Balaji, an employee of DigiBank, who will buy this
commercial paper, hold it for a period of time, and then redeem it with
MagnetoCorp for a small profit.</p>
<p>You’ll act as an developer, end user, and administrator, each in different
organizations, performing the following steps designed to help you understand
what it’s like to collaborate as two different organizations working
independently, but according to mutually agreed rules in a Hyperledger Fabric
network.</p>
<ul class="simple">
<li><p>[Set up machine](#prerequisites) and [download samples](#download-samples)</p></li>
<li><p>[Create the network](#create-the-network)</p></li>
<li><p>[Examine the commercial paper smart contract](#examine-the-commercial-paper-smart-contract)</p></li>
<li><p>[Deploy the smart contract to the channel](#deploy-the-smart-contract-to-the-channel)
by approving the chaincode definition as MagnetoCorp and Digibank.</p></li>
<li><p>Understand the structure of a MagnetoCorp [application](#application-structure),
including its [dependencies](#application-dependencies)</p></li>
<li><p>Configure and use a [wallet and identities](#wallet)</p></li>
<li><p>Run a MagnetoCorp application to [issue a commercial paper](#issue-application)</p></li>
<li><p>Understand how DigiBank uses the smart contract in their [applications](#digibank-applications)</p></li>
<li><p>As Digibank, run applications that
[buy](#buy-application) and [redeem](#redeem-application) commercial paper</p></li>
</ul>
<p>This tutorial has been tested on MacOS and Ubuntu, and should work on other
Linux distributions. A Windows version is under development.</p>
<p>## Prerequisites</p>
<p>Before you start, you must install some prerequisite technology required by the
tutorial. We’ve kept these to a minimum so that you can get going quickly.</p>
<p>You <strong>must</strong> have the following technologies installed:</p>
<blockquote>
<div><ul class="simple">
<li><p>[<strong>Node</strong>](<a class="reference external" href="https://nodejs.org/en/about/">https://nodejs.org/en/about/</a>) version 8.9.0, or higher. Node is
a JavaScript runtime that you can use to run applications and smart
contracts. You are recommended to use the LTS (Long Term Support) version
of node. Install node [here](<a class="reference external" href="https://nodejs.org/en/">https://nodejs.org/en/</a>).</p></li>
<li><p>[<strong>Docker</strong>](<a class="reference external" href="https://www.docker.com/get-started">https://www.docker.com/get-started</a>) version 18.06, or higher.
Docker help developers and administrators create standard environments for
building and running applications and smart contracts. Hyperledger Fabric is
provided as a set of Docker images, and the PaperNet smart contract will run
in a Docker container. Install Docker
[here](<a class="reference external" href="https://www.docker.com/get-started">https://www.docker.com/get-started</a>).</p></li>
</ul>
</div></blockquote>
<p>You <strong>will</strong> find it helpful to install the following technologies:</p>
<blockquote>
<div><ul>
<li><p>A source code editor, such as
[<strong>Visual Studio Code</strong>](<a class="reference external" href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>) version 1.28, or
higher. VS Code will help you develop and test your application and smart
contract. Install VS Code [here](<a class="reference external" href="https://code.visualstudio.com/Download">https://code.visualstudio.com/Download</a>).</p>
<p>Many excellent code editors are available including
[Atom](<a class="reference external" href="https://atom.io/">https://atom.io/</a>), [Sublime Text](<a class="reference external" href="http://www.sublimetext.com/">http://www.sublimetext.com/</a>) and
[Brackets](<a class="reference external" href="http://www.sublimetext.com/">http://www.sublimetext.com/</a>).</p>
</li>
</ul>
</div></blockquote>
<p>You <strong>may</strong> find it helpful to install the following technologies as you become
more experienced with application and smart contract development. There’s no
requirement to install these when you first run the tutorial:</p>
<blockquote>
<div><ul class="simple">
<li><p>[<strong>Node Version Manager</strong>](<a class="reference external" href="https://github.com/creationix/nvm">https://github.com/creationix/nvm</a>). NVM helps you
easily switch between different versions of node – it can be really helpful
if you’re working on multiple projects at the same time. Install NVM
[here](<a class="reference external" href="https://github.com/creationix/nvm#installation">https://github.com/creationix/nvm#installation</a>).</p></li>
</ul>
</div></blockquote>
<p>## Download samples</p>
<p>The commercial paper tutorial is one of the samples in the <cite>fabric-samples</cite>
directory. Before you begin this tutorial, ensure that you have followed the
instructions to install the Fabric [Prerequisites](../prereqs.html) and
[Download the Samples, Binaries and Docker Images](../install.html).
When you are finished, you will have cloned the <cite>fabric-samples</cite> repository that
contains the tutorial scripts, smart contract, and application files.</p>
<p>![commercialpaper.download](./commercial_paper.diagram.2.png) <em>Download the
`fabric-samples` GitHub repository to your local machine.</em></p>
<p>After downloading, feel free to examine the directory structure of <cite>fabric-samples</cite>:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
$ cd fabric-samples
$ ls</p>
<p>CODEOWNERS            basic-network                         first-network
CODE_OF_CONDUCT.md        chaincode                             high-throughput
CONTRIBUTING.md       chaincode-docker-devmode  interest_rate_swaps
Jenkinsfile           ci                        off_chain_data
LICENSE               ci.properties             scripts
MAINTAINERS.md        commercial-paper          test-network
README.md             docs
SECURITY.md           fabcar
<a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
<p>Notice the <cite>commercial-paper</cite> directory – that’s where our sample is located!</p>
<p>You’ve now completed the first stage of the tutorial! As you proceed, you’ll
open multiple command windows for different users and components. For example:</p>
<ul class="simple">
<li><p>To show peer, orderer and CA log output from your network.</p></li>
<li><p>To approve the chaincode as an administrator from MagnetoCorp and as an
administrator from DigiBank.</p></li>
<li><p>To run applications on behalf of Isabella and Balaji, who will use the smart
contract to trade commercial paper with each other.</p></li>
</ul>
<p>We’ll make it clear when you should run a command from particular command
window; for example:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(isabella)$</span> <span class="pre">ls</span>
<span class="pre">`</span></code></p>
<p>indicates that you should run the <cite>ls</cite> command from Isabella’s window.</p>
<p>## Create the network</p>
<p>This tutorial will deploy a smart contract using the Fabric test network.
The test network consists of two peer organizations and an ordering organization.
The two peer organizations operate one peer each, while the ordering organization
operates a single node raft ordering service. We will also use the test network
to create a single channel named <cite>mychannel</cite> that both peer organizations will
be members of.</p>
<p>![commercialpaper.network](./commercial_paper.diagram.testnet.png)
<em>The Fabric test network is comprised of two peer organizations, Org1 and Org2,
each with one peer and its ledger database, an ordering node. Each of these
components runs as a Docker container.</em></p>
<p>The two peers, the peer [ledgers](../ledger/ledger.html#world-state-database-options), the
orderer and the CA each run in the their own Docker container. In production
environments, organizations typically use existing CAs that are shared with
other systems; they’re not dedicated to the Fabric network.</p>
<p>The two organizations of the test network allow us to interact with a blockchain
ledger as two organizations that operate separate peers. In this tutorial,
we will operate Org1 of the test network as DigiBank and Org2 as MagnetoCorp.</p>
<p>You can start the test network and create the channel with a script provided in
the commercial paper directory. Change to the <cite>commercial-paper</cite> directory in
the <cite>fabric-samples</cite>:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">fabric-samples/commercial-paper</span>
<span class="pre">`</span></code>
Then use the script to start the test network:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">./network-starter.sh</span>
<span class="pre">`</span></code>
If the command is successful, you will see the test network being created in your
logs. You can use the <cite>docker ps</cite> command to see the Fabric nodes running on your
local machine:
<a href="#id7"><span class="problematic" id="id8">``</span></a>`
$ docker ps</p>
<p>CONTAINER ID        IMAGE                               COMMAND                  CREATED             STATUS              PORTS                                        NAMES
321cc489b10f        hyperledger/fabric-peer:latest      “peer node start”        2 minutes ago       Up 2 minutes        0.0.0.0:7051-&gt;7051/tcp                       peer0.org1.example.com
ad668671f95f        hyperledger/fabric-peer:latest      “peer node start”        2 minutes ago       Up 2 minutes        7051/tcp, 0.0.0.0:9051-&gt;9051/tcp             peer0.org2.example.com
caadbe4d8592        hyperledger/fabric-couchdb          “tini – /docker-ent…”   2 minutes ago       Up 2 minutes        4369/tcp, 9100/tcp, 0.0.0.0:7984-&gt;5984/tcp   couchdb1
ebabe52903b8        hyperledger/fabric-couchdb          “tini – /docker-ent…”   2 minutes ago       Up 2 minutes        4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp   couchdb0
7c72711c6e18        hyperledger/fabric-orderer:latest   “orderer”                2 minutes ago       Up 2 minutes        0.0.0.0:7050-&gt;7050/tcp                       orderer.example.com
<a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a></p>
<p>See if you can map these containers to the nodes of the test network (you may
need to horizontally scroll to locate the information):</p>
<ul class="simple">
<li><p>The Org1 peer, <cite>peer0.org1.example.com</cite>, is running in container <cite>321cc489b10f</cite></p></li>
<li><p>The Org2 peer, <cite>peer0.org2.example.com</cite>, is running in container <cite>ad668671f95f</cite></p></li>
<li><p>The CouchDB database for the Org1 peer, <cite>couchdb0</cite>, is running in container <cite>ebabe52903b8</cite></p></li>
<li><p>The CouchDB database for the Org2 peer, <cite>couchdb1</cite>, is running in container <cite>caadbe4d8592</cite></p></li>
<li><p>The ordering node <cite>orderer.example.com</cite> is running in container <cite>7c72711c6e18</cite></p></li>
</ul>
<p>These containers all form a [Docker network](<a class="reference external" href="https://docs.docker.com/network/">https://docs.docker.com/network/</a>)
called <cite>net_test</cite>. You can view the network with the <cite>docker network</cite> command:</p>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a>`
$ docker network inspect net_test</p>
<blockquote>
<div><blockquote>
<div><dl>
<dt>{</dt><dd><blockquote>
<div><p>“Name”: “net_test”,
“Id”: “b77b99d29e37677fac48b7ecd78383bdebf09ebdd6b00e87e3d9444252b1ce31”,
“Created”: “2020-01-30T23:04:39.6157465Z”,
“Containers”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“321cc489b10ff46554d0b215da307d38daf35b68bbea635ae0ae3176c3ae0945”: {</dt><dd><p>“Name”: “peer0.org1.example.com”,
“IPv4Address”: “192.168.224.5/20”,</p>
</dd>
</dl>
<p>},
“7c72711c6e18caf7bff4cf78c27efc9ef3b2359a749c926c8aba1beacfdb0211”: {</p>
<blockquote>
<div><p>“Name”: “orderer.example.com”,
“IPv4Address”: “192.168.224.4/20”,</p>
</div></blockquote>
<p>},
“ad668671f95f351f0119320198e1d1e19ebbb0d75766c6c8b9bb7bd36ba506af”: {</p>
<blockquote>
<div><p>“Name”: “peer0.org2.example.com”,
“IPv4Address”: “192.168.224.6/20”,</p>
</div></blockquote>
<p>},
“caadbe4d8592aa558fe14d07a424a9e04365620ede1143b6ce5902ce038c0851”: {</p>
<blockquote>
<div><p>“Name”: “couchdb1”,
“IPv4Address”: “192.168.224.2/20”,</p>
</div></blockquote>
<p>},
“ebabe52903b8597d016dbc0d0ca4373ef75162d3400efbe6416975abafd08a8f”: {</p>
<blockquote>
<div><p>“Name”: “couchdb0”,
“IPv4Address”: “192.168.224.3/20”,</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
“Labels”: {}</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p><a href="#id15"><span class="problematic" id="id16">``</span></a>`
See how the five containers use different IP addresses, while being part of a
single Docker network. (We’ve abbreviated the output for clarity.)</p>
<p>Because we are operating the test network as DigiBank and MagnetoCorp,
<cite>peer0.org1.example.com</cite> will belong to the DigiBank organization while
<cite>peer0.org2.example.com</cite> will be operated by MagnetoCorp. Now that the test
network is up and running, we can refer our network as PaperNet from this point
forward.</p>
<p>To recap: you’ve downloaded the Hyperledger Fabric samples repository from
GitHub and you’ve got the test network running on your local machine. Let’s now
start to play the role of MagnetoCorp, who wish to trade commercial paper.</p>
<p>## Monitor the network as MagnetoCorp</p>
<p>The commercial paper tutorial allows you to act as two organizations by
providing two separate folders for DigiBank and MagnetoCorp. The two folders
contain the smart contracts and application files for each organization. Because
the two organizations have different roles in the trading of the commercial paper,
the application files are different for each organization. Open a new window in
the <cite>fabric-samples</cite> repository and use the following command to change into
the MagnetoCorp directory:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">commercial-paper/organization/magnetocorp</span>
<span class="pre">`</span></code>
The first thing we are going to do as MagnetoCorp is monitor the components
of PaperNet. An administrator can view the aggregated output from a set
of Docker containers using the <cite>logspout</cite> [tool](<a class="reference external" href="https://github.com/gliderlabs/logspout#logspout">https://github.com/gliderlabs/logspout#logspout</a>).
The tool collects the different output streams into one place, making it easy
to see what’s happening from a single window. This can be really helpful for
administrators when installing smart contracts or for developers when invoking
smart contracts, for example.</p>
<p>In the MagnetoCorp directory, run the following command to run the
<cite>monitordocker.sh</cite>  script and start the <cite>logspout</cite> tool for the containers
associated with PaperNet running on <cite>net_test</cite>:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(magnetocorp</span> <span class="pre">admin)$</span> <span class="pre">./configuration/cli/monitordocker.sh</span> <span class="pre">net_test</span>
<span class="pre">...</span>
<span class="pre">latest:</span> <span class="pre">Pulling</span> <span class="pre">from</span> <span class="pre">gliderlabs/logspout</span>
<span class="pre">4fe2ade4980c:</span> <span class="pre">Pull</span> <span class="pre">complete</span>
<span class="pre">decca452f519:</span> <span class="pre">Pull</span> <span class="pre">complete</span>
<span class="pre">(...)</span>
<span class="pre">Starting</span> <span class="pre">monitoring</span> <span class="pre">on</span> <span class="pre">all</span> <span class="pre">containers</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">network</span> <span class="pre">net_test</span>
<span class="pre">b7f3586e5d0233de5a454df369b8eadab0613886fc9877529587345fc01a3582</span>
<span class="pre">`</span></code></p>
<p>Note that you can pass a port number to the above command if the default port in <cite>monitordocker.sh</cite> is already in use.
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(magnetocorp</span> <span class="pre">admin)$</span> <span class="pre">./monitordocker.sh</span> <span class="pre">net_test</span> <span class="pre">&lt;port_number&gt;</span>
<span class="pre">`</span></code></p>
<p>This window will now show output from the Docker containers for the remainder of the
tutorial, so go ahead and open another command window. The next thing we will do is
examine the smart contract that MagnetoCorp will use to issue to the commercial
paper.</p>
<p>## Examine the commercial paper smart contract</p>
<p><cite>issue</cite>, <cite>buy</cite> and <cite>redeem</cite> are the three functions at the heart of the commercial
paper smart contract. It is used by applications to submit transactions which
correspondingly issue, buy and redeem commercial paper on the ledger. Our next
task is to examine this smart contract.</p>
<p>Open a new terminal in the <cite>fabric-samples</cite> directory and change into the
MagnetoCorp folder to act as the MagnetoCorp developer.
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">commercial-paper/organization/magnetocorp</span>
<span class="pre">`</span></code>
You can then view the smart contract in the <cite>contract</cite> directory using your chosen
editor (VS Code in this tutorial):
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(magnetocorp</span> <span class="pre">developer)$</span> <span class="pre">code</span> <span class="pre">contract</span>
<span class="pre">`</span></code></p>
<p>In the <cite>lib</cite> directory of the folder, you’ll see <cite>papercontract.js</cite> file – this
contains the commercial paper smart contract!</p>
<p>![commercialpaper.vscode1](./commercial_paper.vscode.papercontract.png) <em>An
example code editor displaying the commercial paper smart contract in `papercontract.js`</em></p>
<p><cite>papercontract.js</cite> is a JavaScript program designed to run in the Node.js
environment. Note the following key program lines:</p>
<ul>
<li><p><cite>const { Contract, Context } = require(‘fabric-contract-api’);</cite></p>
<p>This statement brings into scope two key Hyperledger Fabric classes that will
be used extensively by the smart contract  – <cite>Contract</cite> and <cite>Context</cite>. You
can learn more about these classes in the
[<cite>fabric-shim</cite> JSDOCS](<a class="reference external" href="https://hyperledger.github.io/fabric-chaincode-node/">https://hyperledger.github.io/fabric-chaincode-node/</a>).</p>
</li>
<li><p><cite>class CommercialPaperContract extends Contract {</cite></p>
<p>This defines the smart contract class <cite>CommercialPaperContract</cite> based on the
built-in Fabric <cite>Contract</cite> class.  The methods which implement the key
transactions to <cite>issue</cite>, <cite>buy</cite> and <cite>redeem</cite> commercial paper are defined
within this class.</p>
</li>
<li><p><cite>async issue(ctx, issuer, paperNumber, issueDateTime, maturityDateTime…) {</cite></p>
<p>This method defines the commercial paper <cite>issue</cite> transaction for PaperNet. The
parameters that are passed to this method will be used to create the new
commercial paper.</p>
<p>Locate and examine the <cite>buy</cite> and <cite>redeem</cite> transactions within the smart
contract.</p>
</li>
<li><p><cite>let paper = CommercialPaper.createInstance(issuer, paperNumber, issueDateTime…);</cite></p>
<p>Within the <cite>issue</cite> transaction, this statement creates a new commercial paper
in memory using the <cite>CommercialPaper</cite> class with the supplied transaction
inputs. Examine the <cite>buy</cite> and <cite>redeem</cite> transactions to see how they similarly
use this class.</p>
</li>
<li><p><cite>await ctx.paperList.addPaper(paper);</cite></p>
<p>This statement adds the new commercial paper to the ledger using
<cite>ctx.paperList</cite>, an instance of a <cite>PaperList</cite> class that was created when the
smart contract context <cite>CommercialPaperContext</cite> was initialized. Again,
examine the <cite>buy</cite> and <cite>redeem</cite> methods to see how they use this class.</p>
</li>
<li><p><cite>return paper;</cite></p>
<p>This statement returns a binary buffer as response from the <cite>issue</cite>
transaction for processing by the caller of the smart contract.</p>
</li>
</ul>
<p>Feel free to examine other files in the <cite>contract</cite> directory to understand how
the smart contract works, and read in detail how <cite>papercontract.js</cite> is
designed in the smart contract [topic](../developapps/smartcontract.html).</p>
<p>## Deploy the smart contract to the channel</p>
<p>Before <cite>papercontract</cite> can be invoked by applications, it must be installed onto
the appropriate peer nodes of the test network and then defined on the channel
using the [Fabric chaincode lifecycle](../chaincode_lifecycle.html#chaincode-lifecycle). The Fabric chaincode
lifecycle allows multiple organizations to agree to the parameters of a chaincode
before the chainocde is deployed to a channel. As a result, we need to install
and approve the chaincode as administrators of both MagnetoCorp and DigiBank.</p>
<p>![commercialpaper.install](./commercial_paper.diagram.install.png)  <em>A MagnetoCorp
administrator installs a copy of the `papercontract` onto a MagnetoCorp peer.</em></p>
<p>Smart contracts are the focus of application development, and are contained
within a Hyperledger Fabric artifact called [chaincode](../chaincode.html). One
or more smart contracts can be defined within a single chaincode, and installing
a chaincode will allow them to be consumed by the different organizations in
PaperNet. It means that only administrators need to worry about chaincode;
everyone else can think in terms of smart contracts.</p>
<p>### Install and approve the smart contract as MagnetoCorp</p>
<p>We will first install and approve the smart contract as the MagnetoCorp admin. Make
sure that you are operating from the <cite>magnetocorp</cite> folder, or navigate back to that
folder using the following command:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">commercial-paper/organization/magnetocorp</span>
<span class="pre">`</span></code></p>
<p>A MagnetoCorp administrator can interact with PaperNet using the <cite>peer</cite> CLI. However,
the administrator needs to set certain environment variables in their command
window to use the correct set of <cite>peer</cite> binaries, send commands to the address
of the MagnetoCorp peer, and sign requests with the correct crypto material.</p>
<p>You can use a script provided by the sample to set the environment variables in
your command window. Run the following command in the <cite>magnetocorp</cite> directory:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">source</span> <span class="pre">magnetocorp.sh</span>
<span class="pre">`</span></code></p>
<p>You will see the full list of environment variables printed in your window. We
can now use this command window to interact with PaperNet as the MagnetoCorp
administrator.</p>
<p>The first step is to install the <cite>papercontract</cite> smart contract. The smart
contract can be packaged into a chaincode using the
<cite>peer lifecycle chaincode package</cite> command. In the MagnetoCorp administrator’s
command window, run the following command to create the chaincode package:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(magnetocorp</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">package</span> <span class="pre">cp.tar.gz</span> <span class="pre">--lang</span> <span class="pre">node</span> <span class="pre">--path</span> <span class="pre">./contract</span> <span class="pre">--label</span> <span class="pre">cp_0</span>
<span class="pre">`</span></code>
The MagnetoCorp admin can now install the chaincode on the MagnetoCorp peer using
the <cite>peer lifecycle chaincode install</cite> command:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(magnetocorp</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">install</span> <span class="pre">cp.tar.gz</span>
<span class="pre">`</span></code>
If the command is successful, you will see messages similar to the following
printed in your terminal:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-01-30</span> <span class="pre">18:32:33.762</span> <span class="pre">EST</span> <span class="pre">[cli.lifecycle.chaincode]</span> <span class="pre">submitInstallProposal</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">001</span> <span class="pre">Installed</span> <span class="pre">remotely:</span> <span class="pre">response:&lt;status:200</span> <span class="pre">payload:&quot;\nEcp_0:ffda93e26b183e231b7e9d5051e1ee7ca47fbf24f00a8376ec54120b1a2a335c\022\004cp_0&quot;</span> <span class="pre">&gt;</span>
<span class="pre">2020-01-30</span> <span class="pre">18:32:33.762</span> <span class="pre">EST</span> <span class="pre">[cli.lifecycle.chaincode]</span> <span class="pre">submitInstallProposal</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">002</span> <span class="pre">Chaincode</span> <span class="pre">code</span> <span class="pre">package</span> <span class="pre">identifier:</span> <span class="pre">cp_0:ffda93e26b183e231b7e9d5051e1ee7ca47fbf24f00a8376ec54120b1a2a335c</span>
<span class="pre">`</span></code>
Because the MagnetoCorp admin has set <cite>CORE_PEER_ADDRESS=localhost:9051</cite> to
target its commands to <cite>peer0.org2.example.com</cite>, the <cite>INFO 001 Installed remotely…</cite>
indicates that <cite>papercontract</cite> has been successfully installed on this peer.</p>
<p>After we install the smart contract, we need to approve the chaincode definition
for <cite>papercontract</cite> as MagnetoCorp. The first step is to find the packageID of
the chaincode we installed on our peer. We can query the packageID using the
<cite>peer lifecycle chaincode queryinstalled</cite> command:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">queryinstalled</span>
<span class="pre">`</span></code></p>
<p>The command will return the same package identifier as the install command. You
should see output similar to the following:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">Installed</span> <span class="pre">chaincodes</span> <span class="pre">on</span> <span class="pre">peer:</span>
<span class="pre">Package</span> <span class="pre">ID:</span> <span class="pre">cp_0:ffda93e26b183e231b7e9d5051e1ee7ca47fbf24f00a8376ec54120b1a2a335c,</span> <span class="pre">Label:</span> <span class="pre">cp_0</span>
<span class="pre">`</span></code></p>
<p>We will need the package ID in the next step, so we will save it as an environment
variable. The package ID may not be the same for all users, so you need to
complete this step using the package ID returned from your command window.
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">PACKAGE_ID=cp_0:ffda93e26b183e231b7e9d5051e1ee7ca47fbf24f00a8376ec54120b1a2a335c</span>
<span class="pre">`</span></code></p>
<p>The admin can now approve the chaincode definition for MagnetoCorp using the
<cite>peer lifecycle chaincode approveformyorg</cite> command:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(magnetocorp</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">approveformyorg</span> <span class="pre">--orderer</span> <span class="pre">localhost:7050</span> <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">--channelID</span> <span class="pre">mychannel</span> <span class="pre">--name</span> <span class="pre">papercontract</span> <span class="pre">-v</span> <span class="pre">0</span> <span class="pre">--package-id</span> <span class="pre">$PACKAGE_ID</span> <span class="pre">--sequence</span> <span class="pre">1</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">$ORDERER_CA</span>
<span class="pre">`</span></code></p>
<p>One of the most important chaincode parameters that channel members need to
agree to using the chaincode definition is the chaincode [endorsement policy](../endorsement-policies.html).
The endorsement policy describes the set of organizations that must endorse
(execute and sign) a transaction before it can be determined to be valid. By
approving the <cite>papercontract</cite> chaincode without the <code class="docutils literal notranslate"><span class="pre">--policy</span></code> flag, the
MagnetoCorp admin agrees to using the default endorsement policy, which requires a
majority of organizations on the channel to endorse a transaction. All transactions,
whether valid or invalid, will be recorded on the [ledger blockchain](../ledger/ledger.html#blockchain),
but only valid transactions will update the [world state](../ledger/ledger.html#world-state).</p>
<p>### Install and approve the smart contract as DigiBank</p>
<p>By default, the Fabric Chaincode lifecycle requires a majority of organizations
on the channel to successfully commit the chaincode definition to the channel.
This implies that we need to approve the <cite>papernet</cite> chaincode as both MagnetoCorp
and DigiBank to get the required majority of 2 out of 2. Open a new terminal
window in the <cite>fabric-samples</cite> and navigate to the older that contains the
DigiBank smart contract and application files:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(digibank</span> <span class="pre">admin)$</span> <span class="pre">cd</span> <span class="pre">commercial-paper/organization/digibank/</span>
<span class="pre">`</span></code>
Use the script in the DigiBank folder to set the environment variables that will
allow you to act as the DigiBank admin:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">source</span> <span class="pre">digibank.sh</span>
<span class="pre">`</span></code></p>
<p>We can now install and approve <cite>papercontract</cite> as the DigiBank. Run the following
command to package the chaincode:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(digibank</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">package</span> <span class="pre">cp.tar.gz</span> <span class="pre">--lang</span> <span class="pre">node</span> <span class="pre">--path</span> <span class="pre">./contract</span> <span class="pre">--label</span> <span class="pre">cp_0</span>
<span class="pre">`</span></code>
The admin can now install the chaincode on the DigiBank peer:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(digibank</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">install</span> <span class="pre">cp.tar.gz</span>
<span class="pre">`</span></code>
We then need to query and save the packageID of the chaincode that was just
installed:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(digibank</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">queryinstalled</span>
<span class="pre">`</span></code>
Save the package ID as an environment variable. Complete this step using the
package ID returned from your console.
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">PACKAGE_ID=cp_0:ffda93e26b183e231b7e9d5051e1ee7ca47fbf24f00a8376ec54120b1a2a335c</span>
<span class="pre">`</span></code></p>
<p>The Digibank admin can now approve the chaincode definition of <cite>papercontract</cite>:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(digibank</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">approveformyorg</span> <span class="pre">--orderer</span> <span class="pre">localhost:7050</span> <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">--channelID</span> <span class="pre">mychannel</span> <span class="pre">--name</span> <span class="pre">papercontract</span> <span class="pre">-v</span> <span class="pre">0</span> <span class="pre">--package-id</span> <span class="pre">$PACKAGE_ID</span> <span class="pre">--sequence</span> <span class="pre">1</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">$ORDERER_CA</span>
<span class="pre">`</span></code></p>
<p>### Commit the chaincode definition to the channel</p>
<p>Now that DigiBank and MagnetoCorp have both approved the <cite>papernet</cite> chaincode, we
have the majority we need (2 out of 2) to commit the chaincode definition to the
channel. Once the chaincode is successfully defined on the channel, the
<cite>CommercialPaper</cite> smart contract inside the <cite>papercontract</cite> chaincode can be
invoked by client applications on the channel. Since either organization can
commit the chaincode to the channel, we will continue operating as the
DigiBank admin:</p>
<p>![commercialpaper.commit](./commercial_paper.diagram.commit.png)  <em>After the DigiBank administrator commits the definition of the `papercontract` chaincode to the channel, a new Docker chaincode container will be created to run `papercontract` on both PaperNet peers</em></p>
<p>The DigiBank administrator uses the <cite>peer lifecycle chaincode commit</cite> command
to commit the chaincode definition of <cite>papercontract</cite> to <cite>mychannel</cite>:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(digibank</span> <span class="pre">admin)$</span> <span class="pre">peer</span> <span class="pre">lifecycle</span> <span class="pre">chaincode</span> <span class="pre">commit</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span> <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">--peerAddresses</span> <span class="pre">localhost:7051</span> <span class="pre">--tlsRootCertFiles</span> <span class="pre">${PEER0_ORG1_CA}</span> <span class="pre">--peerAddresses</span> <span class="pre">localhost:9051</span> <span class="pre">--tlsRootCertFiles</span> <span class="pre">${PEER0_ORG2_CA}</span> <span class="pre">--channelID</span> <span class="pre">mychannel</span> <span class="pre">--name</span> <span class="pre">papercontract</span> <span class="pre">-v</span> <span class="pre">0</span> <span class="pre">--sequence</span> <span class="pre">1</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">$ORDERER_CA</span> <span class="pre">--waitForEvent</span>
<span class="pre">`</span></code>
The chaincode container will start after the chaincode definition has been
committed to the channel. You can use the <cite>docker ps</cite> command to see
<cite>papercontract</cite> container starting on both peers.</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a>`
(digibank admin)$ docker ps</p>
<p>CONTAINER ID        IMAGE                                                                                                                                                               COMMAND                  CREATED             STATUS              PORTS                                        NAMES
d4ba9dc9c55f        dev-peer0.org1.example.com-cp_0-ebef35e7f1f25eea1dcc6fcad5019477cd7f434c6a5dcaf4e81744e282903535-05cf67c20543ee1c24cf7dfe74abce99785374db15b3bc1de2da372700c25608   “docker-entrypoint.s…”   30 seconds ago      Up 28 seconds                                                    dev-peer0.org1.example.com-cp_0-ebef35e7f1f25eea1dcc6fcad5019477cd7f434c6a5dcaf4e81744e282903535
a944c0f8b6d6        dev-peer0.org2.example.com-cp_0-1487670371e56d107b5e980ce7f66172c89251ab21d484c7f988c02912ddeaec-1a147b6fd2a8bd2ae12db824fad8d08a811c30cc70bc5b6bc49a2cbebc2e71ee   “docker-entrypoint.s…”   31 seconds ago      Up 28 seconds                                                    dev-peer0.org2.example.com-cp_0-1487670371e56d107b5e980ce7f66172c89251ab21d484c7f988c02912ddeaec
<a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a></p>
<p>Notice that the containers are named to indicate the peer that started it, and
the fact that it’s running <cite>papercontract</cite> version <cite>0</cite>.</p>
<p>Now that we have deployed the <cite>papercontract</cite> chaincode to the channel, we can
use the MagnetoCorp application to issue the commercial paper. Let’s take a
moment to examine the application structure.</p>
<p>## Application structure</p>
<p>The smart contract contained in <cite>papercontract</cite> is called by MagnetoCorp’s
application <cite>issue.js</cite>. Isabella uses this application to submit a transaction
to the ledger which issues commercial paper <cite>00001</cite>. Let’s quickly examine how
the <cite>issue</cite> application works.</p>
<p>![commercialpaper.application](./commercial_paper.diagram.8.png) <em>A gateway
allows an application to focus on transaction generation, submission and
response. It coordinates transaction proposal, ordering and notification
processing between the different network components.</em></p>
<p>Because the <cite>issue</cite> application submits transactions on behalf of Isabella, it
starts by retrieving Isabella’s X.509 certificate from her
[wallet](../developapps/wallet.html), which might be stored on the local file
system or a Hardware Security Module
[HSM](<a class="reference external" href="https://en.wikipedia.org/wiki/Hardware_security_module">https://en.wikipedia.org/wiki/Hardware_security_module</a>). The <cite>issue</cite>
application is then able to utilize the gateway to submit transactions on the
channel. The Hyperledger Fabric SDK provides a
[gateway](../developapps/gateway.html) abstraction so that applications can
focus on application logic while delegating network interaction to the
gateway. Gateways and wallets make it straightforward to write Hyperledger
Fabric applications.</p>
<p>So let’s examine the <cite>issue</cite> application that Isabella is going to use. Open a
separate terminal window for her, and in <cite>fabric-samples</cite> locate the MagnetoCorp
<cite>/application</cite> folder:</p>
<p><a href="#id23"><span class="problematic" id="id24">``</span></a>`
(isabella)$ cd commercial-paper/organization/magnetocorp/application/
(isabella)$ ls</p>
<p>addToWallet.js          issue.js                package.json
<a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a></p>
<p><cite>addToWallet.js</cite> is the program that Isabella is going to use to load her
identity into her wallet, and <cite>issue.js</cite> will use this identity to create
commercial paper <cite>00001</cite> on behalf of MagnetoCorp by invoking <cite>papercontract</cite>.</p>
<p>Change to the directory that contains MagnetoCorp’s copy of the application
<cite>issue.js</cite>, and use your code editor to examine it:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(isabella)$</span> <span class="pre">cd</span> <span class="pre">commercial-paper/organization/magnetocorp/application</span>
<span class="pre">(isabella)$</span> <span class="pre">code</span> <span class="pre">issue.js</span>
<span class="pre">`</span></code></p>
<p>Examine this directory; it contains the issue application and all its
dependencies.</p>
<p>![commercialpaper.vscode2](./commercial_paper.vscode.issue.png) <em>A code editor
displaying the contents of the commercial paper application directory.</em></p>
<p>Note the following key program lines in <cite>issue.js</cite>:</p>
<ul>
<li><p><cite>const { Wallets, Gateway } = require(‘fabric-network’);</cite></p>
<p>This statement brings two key Hyperledger Fabric SDK classes into scope –
<cite>Wallet</cite> and <cite>Gateway</cite>.</p>
</li>
<li><p><cite>const wallet = await Wallets.newFileSystemWallet(‘../identity/user/isabella/wallet’);</cite></p>
<p>This statement identifies that the application will use <cite>isabella</cite> wallet when
it connects to the blockchain network channel. Because Isabella’s X.509 certificate
is in the local file system, the application creates a new <cite>FileSystemWallet</cite>. The
application will select a particular identity within <cite>isabella</cite> wallet.</p>
</li>
<li><p><cite>await gateway.connect(connectionProfile, connectionOptions);</cite></p>
<p>This line of code connects to the network using the gateway identified by
<cite>connectionProfile</cite>, using the identity referred to in <cite>ConnectionOptions</cite>.</p>
<p>See how <cite>../gateway/networkConnection.yaml</cite> and <cite>User1&#64;org1.example.com</cite> are
used for these values respectively.</p>
</li>
<li><p><cite>const network = await gateway.getNetwork(‘mychannel’);</cite></p>
<p>This connects the application to the network channel <cite>mychannel</cite>, where the
<cite>papercontract</cite> was previously instantiated.</p>
</li>
<li><p><cite>const contract = await network.getContract(‘papercontract’);</cite></p>
<p>This statement gives the application access to the <cite>papercontract</cite> chaincode.
Once an application has issued getContract, it can submit to any smart contract
transaction implemented within the chaincode.</p>
</li>
<li><p><cite>const issueResponse = await contract.submitTransaction(‘issue’, ‘MagnetoCorp’, ‘00001’, …);</cite></p>
<p>This line of code submits the a transaction to the network using the <cite>issue</cite>
transaction defined within the smart contract. <cite>MagnetoCorp</cite>, <cite>00001</cite>… are
the values to be used by the <cite>issue</cite> transaction to create a new commercial
paper.</p>
</li>
<li><p><cite>let paper = CommercialPaper.fromBuffer(issueResponse);</cite></p>
<p>This statement processes the response from the <cite>issue</cite> transaction. The
response needs to deserialized from a buffer into <cite>paper</cite>, a <cite>CommercialPaper</cite>
object which can interpreted correctly by the application.</p>
</li>
</ul>
<p>Feel free to examine other files in the <cite>/application</cite> directory to understand
how <cite>issue.js</cite> works, and read in detail how it is implemented in the
application [topic](../developapps/application.html).</p>
<p>## Application dependencies</p>
<p>The <cite>issue.js</cite> application is written in JavaScript and designed to run in the
Node.js environment that acts as a client to the PaperNet network.
As is common practice, MagnetoCorp’s application is built on many
external node packages — to improve quality and speed of development. Consider
how <cite>issue.js</cite> includes the <cite>js-yaml</cite>
[package](<a class="reference external" href="https://www.npmjs.com/package/js-yaml">https://www.npmjs.com/package/js-yaml</a>) to process the YAML gateway
connection profile, or the <cite>fabric-network</cite>
[package](<a class="reference external" href="https://www.npmjs.com/package/fabric-network">https://www.npmjs.com/package/fabric-network</a>) to access the <cite>Gateway</cite>
and <cite>Wallet</cite> classes:</p>
<p><code class="docutils literal notranslate"><span class="pre">`JavaScript</span>
<span class="pre">const</span> <span class="pre">yaml</span> <span class="pre">=</span> <span class="pre">require('js-yaml');</span>
<span class="pre">const</span> <span class="pre">{</span> <span class="pre">Wallets,</span> <span class="pre">Gateway</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">require('fabric-network');</span>
<span class="pre">`</span></code></p>
<p>These packages have to be downloaded from [npm](<a class="reference external" href="https://www.npmjs.com/">https://www.npmjs.com/</a>) to the
local file system using the <cite>npm install</cite> command. By convention, packages must
be installed into an application-relative <cite>/node_modules</cite> directory for use at
runtime.</p>
<p>Examine the <cite>package.json</cite> file to see how <cite>issue.js</cite> identifies the packages to
download and their exact versions:</p>
<dl>
<dt><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a>json</dt><dd><dl class="simple">
<dt>“dependencies”: {</dt><dd><p>“fabric-network”: “~1.4.0”,
“fabric-client”: “~1.4.0”,
“js-yaml”: “^3.12.0”</p>
</dd>
</dl>
<p>},</p>
</dd>
</dl>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a></p>
<p><strong>npm</strong> versioning is very powerful; you can read more about it
[here](<a class="reference external" href="https://docs.npmjs.com/getting-started/semantic-versioning">https://docs.npmjs.com/getting-started/semantic-versioning</a>).</p>
<p>Let’s install these packages with the <cite>npm install</cite> command – this may take up
to a minute to complete:</p>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a>`
(isabella)$ cd commercial-paper/organization/magnetocorp/application/
(isabella)$ npm install</p>
<p>(           ) extract:lodash: sill extract ansi-styles&#64;3.2.1
(…)
added 738 packages in 46.701s
<a href="#id39"><span class="problematic" id="id40">``</span></a><a href="#id41"><span class="problematic" id="id42">`</span></a></p>
<p>See how this command has updated the directory:</p>
<p><a href="#id43"><span class="problematic" id="id44">``</span></a>`
(isabella)$ ls</p>
<p>addToWallet.js          node_modules            package.json
issue.js                package-lock.json
<a href="#id45"><span class="problematic" id="id46">``</span></a><a href="#id47"><span class="problematic" id="id48">`</span></a></p>
<p>Examine the <cite>node_modules</cite> directory to see the packages that have been
installed. There are lots, because <cite>js-yaml</cite> and <cite>fabric-network</cite> are themselves
built on other npm packages! Helpfully, the <cite>package-lock.json</cite>
[file](<a class="reference external" href="https://docs.npmjs.com/files/package-lock.json">https://docs.npmjs.com/files/package-lock.json</a>) identifies the exact
versions installed, which can prove invaluable if you want to exactly reproduce
environments; to test, diagnose problems or deliver proven applications for
example.</p>
<p>## Wallet</p>
<p>Isabella is almost ready to run <cite>issue.js</cite> to issue MagnetoCorp commercial paper
<cite>00001</cite>; there’s just one remaining task to perform! As <cite>issue.js</cite> acts on
behalf of Isabella, and therefore MagnetoCorp, it will use identity from her
[wallet](../developapps/wallet.html) that reflects these facts. We now need to
perform this one-time activity of adding appropriate X.509 credentials to her
wallet.</p>
<p>In Isabella’s terminal window, run the <cite>addToWallet.js</cite> program to add identity
information to her wallet:</p>
<p><a href="#id49"><span class="problematic" id="id50">``</span></a>`
(isabella)$ node addToWallet.js</p>
<p>done
<a href="#id51"><span class="problematic" id="id52">``</span></a><a href="#id53"><span class="problematic" id="id54">`</span></a></p>
<p><cite>addToWallet.js</cite> is a simple file-copying program which you can examine at your
leisure. It moves an identity from the test network sample to Isabella’s
wallet. Let’s focus on the result of this program — the contents of
the wallet which will be used to submit transactions to PaperNet:</p>
<p><a href="#id55"><span class="problematic" id="id56">``</span></a>`
(isabella)$ ls ../identity/user/isabella/wallet/</p>
<p>isabella.id
<a href="#id57"><span class="problematic" id="id58">``</span></a><a href="#id59"><span class="problematic" id="id60">`</span></a></p>
<p>Isabella can store multiple identities in her wallet, though in our example, she
only uses one. The <cite>wallet</cite> folder contains an <cite>isabella.id</cite> file that provides
the information that Isabella needs to connect to the network. Other identities
used by Isabella would have their own file. You can open this file to see the
identity information that <cite>issue.js</cite> will use on behalf of Isabella inside a JSON
file. The output has been formatted for clarity.
<a href="#id61"><span class="problematic" id="id62">``</span></a>`
(isabella)$  cat ../identity/user/isabella/wallet/*</p>
<dl>
<dt>{</dt><dd><dl class="simple">
<dt>“credentials”: {</dt><dd><p>“certificate”: “—–BEGIN CERTIFICATE—–nMIICKTCCAdCgAwIBAgIQWKwvLG+sqeO3LwwQK6avZDAKBggqhkjOPQQDAjBzMQswnCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZynYW5jaXNjbzEZMBcGA1UEChMQb3JnMi5leGFtcGxlLmNvbTEcMBoGA1UEAxMTY2Eunb3JnMi5leGFtcGxlLmNvbTAeFw0yMDAyMDQxOTA5MDBaFw0zMDAyMDExOTA5MDBanMGwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1TnYW4gRnJhbmNpc2NvMQ8wDQYDVQQLEwZjbGllbnQxHzAdBgNVBAMMFlVzZXIxQG9ynZzIuZXhhbXBsZS5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAT4TnTblx0kngfqX+NN7F76Me33VTq3K2NUWZRreoJzq6bAuvdDR+iFvVPKXbdORnVvRSATcXsYlnt20yU7n/53dbo00wSzAOBgNVHQ8BAf8EBAMCB4AwDAYDVR0TAQH/BAIwADArBgNVnHSMEJDAigCDOCdm4irsZFU3D6Hak4+84QRg1N43iwg8w1V6DRhgLyDAKBggqhkjOnPQQDAgNHADBEAiBhzKix1KJcbUy9ey5ulWHRUMbqdVCNHe/mRtUdaJagIgIgYpbZnXf0CSiTXIWOJIsswN4Jp+ZxkJfFVmXndqKqz+VM=n—–END CERTIFICATE—–n”,
“privateKey”: “—–BEGIN PRIVATE KEY—–nMIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQggs55vQg2oXi8gNi8nNidE8Fy5zenohArDq3FGJD8cKU2hRANCAAT4TnTblx0kgfqX+NN7F76Me33VTq3Kn2NUWZRreoJzq6bAuvdDR+iFvVPKXbdORnVvRSATcXsYlt20yU7n/53dbn—–END PRIVATE KEY—–n”</p>
</dd>
</dl>
<p>},
“mspId”: “Org2MSP”,
“type”: “X.509”,
“version”: 1</p>
</dd>
</dl>
<div class="section" id="id63">
<h1>}<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h1>
<p>In the file you can notice the following:</p>
<ul class="simple">
<li><p>a <cite>“privateKey”:</cite> used to sign transactions on Isabella’s behalf, but not
distributed outside of her immediate control.</p></li>
<li><p>a <cite>“certificate”:</cite> which contains Isabella’s public key and other X.509
attributes added by the Certificate Authority at certificate creation. This
certificate is distributed to the network so that different actors at different
times can cryptographically verify information created by Isabella’s private key.</p></li>
</ul>
<p>You can Learn more about certificates [here](../identity/identity.html#digital-certificates). In practice, the
certificate file also contains some Fabric-specific metadata such as
Isabella’s organization and role – read more in the [wallet](../developapps/wallet.html) topic.</p>
<p>## Issue application</p>
<p>Isabella can now use <cite>issue.js</cite> to submit a transaction that will issue
MagnetoCorp commercial paper <cite>00001</cite>:</p>
<p><a href="#id64"><span class="problematic" id="id65">``</span></a>`
(isabella)$ node issue.js</p>
<p>Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper issue transaction.
Process issue transaction response.{“class”:”org.papernet.commercialpaper”,”key”:””MagnetoCorp”:”00001””,”currentState”:1,”issuer”:”MagnetoCorp”,”paperNumber”:”00001”,”issueDateTime”:”2020-05-31”,”maturityDateTime”:”2020-11-30”,”faceValue”:”5000000”,”owner”:”MagnetoCorp”}
MagnetoCorp commercial paper : 00001 successfully issued for value 5000000
Transaction complete.
Disconnect from Fabric gateway.
Issue program complete.
<a href="#id66"><span class="problematic" id="id67">``</span></a><a href="#id68"><span class="problematic" id="id69">`</span></a></p>
<p>The <cite>node</cite> command initializes a Node.js environment, and runs <cite>issue.js</cite>. We
can see from the program output that MagnetoCorp commercial paper 00001 was
issued with a face value of 5M USD.</p>
<p>As you’ve seen, to achieve this, the application invokes the <cite>issue</cite> transaction
defined in the <cite>CommercialPaper</cite> smart contract within <cite>papercontract.js</cite>. This
had been installed and instantiated in the network by the MagnetoCorp
administrator. It’s the smart contract which interacts with the ledger via the
Fabric APIs, most notably <cite>putState()</cite> and <cite>getState()</cite>, to represent the new
commercial paper as a vector state within the world state. We’ll see how this
vector state is subsequently manipulated by the <cite>buy</cite> and <cite>redeem</cite> transactions
also defined within the smart contract.</p>
<p>All the time, the underlying Fabric SDK handles the transaction endorsement,
ordering and notification process, making the application’s logic
straightforward; the SDK uses a [gateway](../developapps/gateway.html) to
abstract away network details and
[connectionOptions](../developapps/connectoptions.html) to declare more advanced
processing strategies such as transaction retry.</p>
<p>Let’s now follow the lifecycle of MagnetoCorp 00001 by switching our emphasis
to an employee of DigiBank, Balaji, who will buy the commercial paper using a
DigiBank application.</p>
<p>## Digibank applications</p>
<p>Balaji uses DigiBank’s <cite>buy</cite> application to submit a transaction to the ledger
which transfers ownership of commercial paper <cite>00001</cite> from MagnetoCorp to
DigiBank. The <cite>CommercialPaper</cite> smart contract is the same as that used by
MagnetoCorp’s application, however the transaction is different this time –
it’s <cite>buy</cite> rather than <cite>issue</cite>. Let’s examine how DigiBank’s application works.</p>
<p>Open a separate terminal window for Balaji. In <cite>fabric-samples</cite>, change to the
DigiBank application directory that contains the application, <cite>buy.js</cite>, and open
it with your editor:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">(balaji)$</span> <span class="pre">cd</span> <span class="pre">commercial-paper/organization/digibank/application/</span>
<span class="pre">(balaji)$</span> <span class="pre">code</span> <span class="pre">buy.js</span>
<span class="pre">`</span></code></p>
<p>As you can see, this directory contains both the <cite>buy</cite> and <cite>redeem</cite> applications
that will be used by Balaji.</p>
<p>![commercialpaper.vscode3](./commercial_paper.diagram.12.png) <em>DigiBank’s
commercial paper directory containing the `buy.js` and `redeem.js`
applications.</em></p>
<p>DigiBank’s <cite>buy.js</cite> application is very similar in structure to MagnetoCorp’s
<cite>issue.js</cite> with two important differences:</p>
<blockquote>
<div><ul>
<li><p><strong>Identity</strong>: the user is a DigiBank user <cite>Balaji</cite> rather than MagnetoCorp’s
<cite>Isabella</cite></p>
<p><code class="docutils literal notranslate"><span class="pre">`JavaScript</span>
<span class="pre">const</span> <span class="pre">wallet</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">Wallets.newFileSystemWallet('../identity/user/balaji/wallet');</span>
<span class="pre">`</span></code></p>
<p>See how the application uses the <cite>balaji</cite> wallet when it connects to the
PaperNet network channel. <cite>buy.js</cite> selects a particular identity within
<cite>balaji</cite> wallet.</p>
</li>
<li><p><strong>Transaction</strong>: the invoked transaction is <cite>buy</cite> rather than <cite>issue</cite></p>
<p><code class="docutils literal notranslate"><span class="pre">`JavaScript</span>
<span class="pre">const</span> <span class="pre">buyResponse</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">contract.submitTransaction('buy',</span> <span class="pre">'MagnetoCorp',</span> <span class="pre">'00001',</span> <span class="pre">...);</span>
<span class="pre">`</span></code></p>
<p>A <cite>buy</cite> transaction is submitted with the values <cite>MagnetoCorp</cite>, <cite>00001</cite>, …,
that are used by the <cite>CommercialPaper</cite> smart contract class to transfer
ownership of commercial paper <cite>00001</cite> to DigiBank.</p>
</li>
</ul>
</div></blockquote>
<p>Feel free to examine other files in the <cite>application</cite> directory to understand
how the application works, and read in detail how <cite>buy.js</cite> is implemented in
the application [topic](../developapps/application.html).</p>
<p>## Run as DigiBank</p>
<p>The DigiBank applications which buy and redeem commercial paper have a very
similar structure to MagnetoCorp’s issue application. Therefore, let’s install
their dependencies and set up Balaji’s wallet so that he can use these
applications to buy and redeem commercial paper.</p>
<p>Like MagnetoCorp, Digibank must the install the required application packages
using the <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> command, and again, this make take a short time to
complete.</p>
<p>In the DigiBank administrator window, install the application dependencies:</p>
<p><a href="#id70"><span class="problematic" id="id71">``</span></a>`
(digibank admin)$ cd commercial-paper/organization/digibank/application/
(digibank admin)$ npm install</p>
<p>(            ) extract:lodash: sill extract ansi-styles&#64;3.2.1
(…)
added 738 packages in 46.701s
<a href="#id72"><span class="problematic" id="id73">``</span></a><a href="#id74"><span class="problematic" id="id75">`</span></a></p>
<p>In Balaji’s command window, run the <cite>addToWallet.js</cite> program to add the identity
to his wallet:</p>
<p><a href="#id76"><span class="problematic" id="id77">``</span></a>`
(balaji)$ node addToWallet.js</p>
<p>done
<a href="#id78"><span class="problematic" id="id79">``</span></a><a href="#id80"><span class="problematic" id="id81">`</span></a></p>
<p>The <cite>addToWallet.js</cite> program has added identity information for <cite>balaji</cite>, to his
wallet, which will be used by <cite>buy.js</cite> and <cite>redeem.js</cite> to submit transactions to
<cite>PaperNet</cite>.</p>
<p>Like Isabella, Balaji can store multiple identities in his wallet, though in our
example, he only uses one. His corresponding id file at
<cite>digibank/identity/user/balaji/wallet/balaji.id</cite> is very similar Isabella’s —
feel free to examine it.</p>
<p>## Buy application</p>
<p>Balaji can now use <cite>buy.js</cite> to submit a transaction that will transfer ownership
of MagnetoCorp commercial paper 00001 to DigiBank.</p>
<p>Run the <cite>buy</cite> application in Balaji’s window:</p>
<p><a href="#id82"><span class="problematic" id="id83">``</span></a>`
(balaji)$ node buy.js</p>
<p>Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper buy transaction.
Process buy transaction response.
MagnetoCorp commercial paper : 00001 successfully purchased by DigiBank
Transaction complete.
Disconnect from Fabric gateway.
Buy program complete.
<a href="#id84"><span class="problematic" id="id85">``</span></a><a href="#id86"><span class="problematic" id="id87">`</span></a></p>
<p>You can see the program output that MagnetoCorp commercial paper 00001 was
successfully purchased by Balaji on behalf of DigiBank. <cite>buy.js</cite> invoked the
<cite>buy</cite> transaction defined in the <cite>CommercialPaper</cite> smart contract which updated
commercial paper <cite>00001</cite> within the world state using the <cite>putState()</cite> and
<cite>getState()</cite> Fabric APIs. As you’ve seen, the application logic to buy and issue
commercial paper is very similar, as is the smart contract logic.</p>
<p>## Redeem application</p>
<p>The final transaction in the lifecycle of commercial paper 00001 is for
DigiBank to redeem it with MagnetoCorp. Balaji uses <cite>redeem.js</cite> to submit a
transaction to perform the redeem logic within the smart contract.</p>
<p>Run the <cite>redeem</cite> transaction in Balaji’s window:</p>
<p><a href="#id88"><span class="problematic" id="id89">``</span></a>`
(balaji)$ node redeem.js</p>
<p>Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper redeem transaction.
Process redeem transaction response.
MagnetoCorp commercial paper : 00001 successfully redeemed with MagnetoCorp
Transaction complete.
Disconnect from Fabric gateway.
Redeem program complete.
<a href="#id90"><span class="problematic" id="id91">``</span></a><a href="#id92"><span class="problematic" id="id93">`</span></a></p>
<p>Again, see how the commercial paper 00001 was successfully redeemed when
<cite>redeem.js</cite> invoked the <cite>redeem</cite> transaction defined in <cite>CommercialPaper</cite>.
Again, it updated commercial paper <cite>00001</cite> within the world state to reflect
that the ownership returned to MagnetoCorp, the issuer of the paper.</p>
<p>## Clean up</p>
<p>When you are finished using the Commercial Paper tutorial, you can use a script
to clean up your environment. Use a command window to navigate back to the root
directory of the commercial paper sample:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">fabric-samples/commercial-paper</span>
<span class="pre">`</span></code>
You can then bring down the network with the following command:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">./network-clean.sh</span>
<span class="pre">`</span></code>
This command will bring down the peers, CouchDB containers, and ordering node of the network, in addition to the logspout tool. It will also remove the identities that we created for Isabella and Balaji. Note that all of the data on the ledger will be lost. If you want to go through the tutorial again, you will start from a clean initial state.</p>
<p>## Further reading</p>
<p>To understand how applications and smart contracts shown in this tutorial work
in more detail, you’ll find it helpful to read
[Developing Applications](../developapps/developing_applications.html). This
topic will give you a fuller explanation of the commercial paper scenario, the
PaperNet business network, its actors, and how the applications and smart
contracts they use work in detail.</p>
<p>Also feel free to use this sample to start creating your own applications and
smart contracts!</p>
<p>&lt;!— Licensed under Creative Commons Attribution 4.0 International License
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a> –&gt;</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../private_data_tutorial.html" class="btn btn-neutral float-right" title="Using Private Data in Fabric" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../write_first_app.html" class="btn btn-neutral" title="Writing Your First Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>